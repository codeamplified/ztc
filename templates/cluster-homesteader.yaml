# yaml-language-server: $schema=../schema/cluster-schema.json
# Zero Touch Cluster Configuration - Homesteader Template
# Optimized for: 5+ nodes, high availability, and running critical services
# Storage: Cloud-native (Longhorn for block, MinIO for object) + local-path
# Recommended for: Users who value uptime and data safety

cluster:
  name: "ztc-homesteader"
  description: "A resilient, highly-available ZTC cluster for important services"
  version: "1.0.0"
  ha_config:
    enabled: true
    virtual_ip: "192.168.50.9"
    load_balancer:
      type: "kube-vip"

network:
  subnet: "192.168.50.0/24"
  gateway: "192.168.50.1"
  pod_cidr: "10.42.0.0/16"
  service_cidr: "10.43.0.0/16"
  dns:
    enabled: true
    # DNS runs on the master nodes, accessed via the VIP
    server_ip: "192.168.50.9"
    domain: "homelab.lan"
    upstreams:
      - "8.8.8.8"
      - "1.1.1.1"

nodes:
  ssh:
    public_key_path: "~/.ssh/id_ed25519.pub"
    private_key_path: "~/.ssh/id_ed25519"
    username: "ubuntu"
    
  cluster_nodes:
    k3s-master-01:
      ip: "192.168.50.10"
      role: "master"
      resources:
        cpu: "2"
        memory: "4Gi"
    k3s-master-02:
      ip: "192.168.50.11"
      role: "master"
      resources:
        cpu: "2"
        memory: "4Gi"
    k3s-master-03:
      ip: "192.168.50.12"
      role: "master"
      resources:
        cpu: "2"
        memory: "4Gi"
    k3s-worker-01:
      ip: "192.168.50.51"
      role: "worker"
      resources:
        cpu: "4"
        memory: "8Gi"
    k3s-worker-02:
      ip: "192.168.50.52"
      role: "worker"
      resources:
        cpu: "4"
        memory: "8Gi"

storage:
  default_storage_class: "longhorn"
  
  local_path:
    enabled: true
  
  longhorn:
    enabled: true
    replica_count: 3
  
  nfs:
    enabled: false  # Can be enabled for RWX shared storage needs
    namespace: "nfs-server"
    backend_storage_class: "longhorn"  # Use replicated storage for resilience
    storage_size: "250Gi"
    storage_class:
      name: "nfs-csi"

components:
  sealed_secrets:
    enabled: true
  
  argocd:
    enabled: true
    namespace: "argocd"
  
  monitoring:
    enabled: true
    namespace: "monitoring"
  
  gitea:
    enabled: true
    namespace: "gitea"
  
  homepage:
    enabled: true
    namespace: "homepage"
  
  minio:
    enabled: true
    namespace: "minio"
    storage_class: "longhorn"
    replicas: 3
    storage_size: "100Gi"
    console:
      enabled: true
      hostname: "minio-console.homelab.lan"
    api:
      hostname: "s3.homelab.lan"

workloads:
  auto_deploy_bundles:
    - "starter"
    - "monitoring"

# dnsmasq configuration for ZTC homelab services
# Generated by Ansible - DO NOT EDIT MANUALLY

# Basic server configuration
port=53
domain-needed
bogus-priv

# Network interface configuration
interface={{ dnsmasq_interface }}
listen-address={{ dnsmasq_listen_address }}
bind-interfaces

# Cache configuration
cache-size={{ dnsmasq_cache_size }}
neg-ttl=60
local-ttl=300

# Wildcard DNS for homelab services
# All *.{{ dns_domain }} domains resolve to Traefik ingress
address=/{{ dns_domain }}/{{ traefik_ingress_ip }}

# Upstream DNS servers for non-homelab queries
{% for dns_server in upstream_dns_servers %}
server={{ dns_server }}
{% endfor %}

# Don't read /etc/hosts (we manage DNS records ourselves)
no-hosts

# Don't read /etc/resolv.conf (we configure upstream servers manually)
no-resolv

# Security settings
stop-dns-rebind
rebind-localhost-ok

# Logging configuration
{% if dnsmasq_log_queries %}
log-queries
log-facility=/var/log/dnsmasq.log
{% endif %}

# Performance settings
dns-forward-max=150

# DHCP settings (disabled - we only provide DNS)
no-dhcp-interface={{ dnsmasq_interface }}

# Additional security
conf-dir=/etc/dnsmasq.d/,*.conf

# Metrics for monitoring (if available)
{% if dns_metrics_enabled %}
# Enable statistics for Prometheus monitoring
enable-tftp=no
{% endif %}